<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>재고 리스트</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background: #111827;
      color: white;
      padding: 16px 20px;
      font-size: 20px;
      font-weight: 600;
    }
    .container {
      max-width: 1000px;
      margin: 24px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }
    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .form-row {
      display: flex;
      gap: 12px;
      margin-bottom: 10px;
    }
    .form-row label {
      width: 110px;
      font-size: 14px;
      padding-top: 6px;
    }
    .form-row input,
    .form-row textarea {
      flex: 1;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 14px;
    }
    .form-row textarea {
      resize: vertical;
      min-height: 60px;
    }
    .hint {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    .btn-primary {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 9px 16px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 4px;
    }
    .btn-primary:hover {
      background: #1d4ed8;
    }
    .btn-danger {
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 13px;
    }
    thead {
      background: #f3f4f6;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      text-align: center;
    }
    th {
      font-weight: 600;
    }
    tbody tr:nth-child(even) {
      background: #fcfcfc;
    }
    .empty-row {
      text-align: center;
      color: #9ca3af;
      padding: 16px 0;
    }
    .badge-id {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 11px;
    }
  </style>
</head>
<body>
  <header>재고 리스트 관리</header>

  <div class="container">
    <!-- 재고 등록 영역 -->
    <div>
      <div class="section-title">재고 추가</div>
      <div class="hint">
        자재번호는 <strong>네가 직접 8자리</strong>로 만들어서 입력하세요.
        (예: <code>AB123456</code> / 숫자, 영문 아무 조합 가능)
      </div>

      <div class="form-row">
        <label for="mat-id">자재번호 (8자리)</label>
        <input id="mat-id" maxlength="8" placeholder="예: AB123456" />
      </div>

      <div class="form-row">
        <label for="mat-name">자재명</label>
        <input id="mat-name" placeholder="예: SUS 볼트" />
      </div>

      <div class="form-row">
        <label for="mat-spec">자재규격</label>
        <input id="mat-spec" placeholder="예: M10 x 40" />
      </div>

      <div class="form-row">
        <label for="mat-price">금액</label>
        <input id="mat-price" type="number" placeholder="예: 1200 (숫자만)" />
      </div>

      <div class="form-row">
        <label for="mat-qty">현재수량</label>
        <input id="mat-qty" type="number" placeholder="예: 50" />
      </div>

      <div class="form-row">
        <label for="mat-note">비고</label>
        <textarea id="mat-note" placeholder="예: 드럼 건조기 라인 예비품"></textarea>
      </div>

      <button class="btn-primary" onclick="handleAdd()">재고 추가</button>
    </div>

    <!-- 재고 리스트 영역 -->
    <div style="margin-top: 28px;">
      <div class="section-title">재고 리스트</div>
      <table>
        <thead>
          <tr>
            <th>No</th>
            <th>자재번호</th>
            <th>자재명</th>
            <th>자재규격</th>
            <th>금액</th>
            <th>현재수량</th>
            <th>비고</th>
            <th>관리</th>
          </tr>
        </thead>
        <tbody id="inventory-body">
          <!-- JS에서 채움 -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // LocalStorage 키 이름
    const STORAGE_KEY = "inventoryList";

    // 페이지 로드 시 기존 데이터 불러오기
    document.addEventListener("DOMContentLoaded", () => {
      renderTable();
    });

    // LocalStorage에서 목록 가져오기
    function loadInventory() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) return arr;
        return [];
      } catch (e) {
        console.error("JSON parse error", e);
        return [];
      }
    }

    // LocalStorage에 저장
    function saveInventory(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    // 재고 추가 버튼 핸들러
    function handleAdd() {
      const idInput = document.getElementById("mat-id");
      const nameInput = document.getElementById("mat-name");
      const specInput = document.getElementById("mat-spec");
      const priceInput = document.getElementById("mat-price");
      const qtyInput = document.getElementById("mat-qty");
      const noteInput = document.getElementById("mat-note");

      const id = idInput.value.trim();
      const name = nameInput.value.trim();
      const spec = specInput.value.trim();
      const priceStr = priceInput.value.trim();
      const qtyStr = qtyInput.value.trim();
      const note = noteInput.value.trim();

      // 자재번호 검증: 8자리 필수
      if (id.length !== 8) {
        alert("자재번호는 정확히 8자리여야 합니다.");
        idInput.focus();
        return;
      }

      if (!name) {
        alert("자재명은 필수입니다.");
        nameInput.focus();
        return;
      }

      const price = priceStr ? Number(priceStr) : 0;
      const qty = qtyStr ? Number(qtyStr) : 0;

      // 기존 목록 불러오기
      const list = loadInventory();

      // 자재번호 중복 체크
      const dup = list.find(item => item.id === id);
      if (dup) {
        const overwrite = confirm("이미 같은 자재번호가 있습니다. 이 항목을 덮어쓸까요?");
        if (!overwrite) return;

        // 덮어쓰기: 기존 항목 수정
        const newList = list.map(item =>
          item.id === id
            ? { ...item, name, spec, price, qty, note, updatedAt: new Date().toISOString() }
            : item
        );
        saveInventory(newList);
        renderTable();
        clearForm();
        return;
      }

      // 새 항목 추가
      const newItem = {
        id,
        name,
        spec,
        price,
        qty,
        note,
        createdAt: new Date().toISOString()
      };

      list.push(newItem);
      saveInventory(list);
      renderTable();
      clearForm();
    }

    // 폼 초기화
    function clearForm() {
      document.getElementById("mat-id").value = "";
      document.getElementById("mat-name").value = "";
      document.getElementById("mat-spec").value = "";
      document.getElementById("mat-price").value = "";
      document.getElementById("mat-qty").value = "";
      document.getElementById("mat-note").value = "";
    }

    // 테이블 렌더링
    function renderTable() {
      const tbody = document.getElementById("inventory-body");
      const list = loadInventory();

      // 최신 입력이 위로 오도록 정렬 (createdAt 기준 내림차순)
      list.sort((a, b) => {
        const ta = a.createdAt || "";
        const tb = b.createdAt || "";
        return ta < tb ? 1 : ta > tb ? -1 : 0;
      });

      if (list.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="empty-row">등록된 재고가 없습니다.</td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = "";
      list.forEach((item, index) => {
        const tr = document.createElement("tr");

        const priceText =
          typeof item.price === "number"
            ? item.price.toLocaleString() + " 원"
            : "-";

        const qtyText =
          typeof item.qty === "number"
            ? item.qty
            : "-";

        tr.innerHTML = `
          <td>${index + 1}</td>
          <td><span class="badge-id">${item.id}</span></td>
          <td>${item.name}</td>
          <td>${item.spec || "-"}</td>
          <td>${priceText}</td>
          <td>${qtyText}</td>
          <td style="text-align:left;">${item.note || "-"}</td>
          <td>
            <button class="btn-danger" onclick="deleteItem('${item.id}')">삭제</button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    }

    // 항목 삭제
    function deleteItem(id) {
      const ok = confirm(`자재번호 ${id} 항목을 삭제하시겠습니까?`);
      if (!ok) return;

      const list = loadInventory();
      const newList = list.filter(item => item.id !== id);
      saveInventory(newList);
      renderTable();
    }
  </script>
</body>
</html>
